scriptName 'RscDisplayLoading'; _fnc_scriptName = 'RscDisplayLoading'; #line 1 "A3\3den\UI\displaysTemp\RscDisplayLoading.sqf"
#line 1 "A3\ui_f\hpp\defineResincl.inc"






















































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































#line 1 "A3\3den\UI\displaysTemp\RscDisplayLoading.sqf"

#line 1 "A3\ui_f\hpp\defineResinclDesign.inc"







































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































#line 2 "A3\3den\UI\displaysTemp\RscDisplayLoading.sqf"


disableserialization;

_mode = _this select 0;
_params = _this select 1;
_class = _this select 2;

switch _mode do {

case "onLoad": {
_display = _params select 0;
RscDisplayLoading_display = _display;


if !(uinamespace getvariable ["BIS_initGame",false]) exitwith {};




_ctrlLoadingStart = _display displayctrl 	2310;
_ctrlLoadingStart ctrlsetfade 1;
_ctrlLoadingStart ctrlcommit 0;
_pictureShot = "";


if (worldname != "") then {
_ctrlMap = _display displayctrl 				999;
_ctrlMapName = _display displayctrl 			1001;
_ctrlMapAuthor = _display displayctrl 		1002;
_ctrlMapDescription = _display displayctrl 		1102;

private _fnc_getCustomWorldConfig = { if (isClass (_this >> worldName)) then { _this >> worldName } else { _this >> "Any" } };

_cfgWorld = getMissionConfig "CfgWorlds" call _fnc_getCustomWorldConfig;
if (!isClass _cfgWorld) then
{
_cfgWorld = (campaignConfigFile >> "CfgWorlds") call _fnc_getCustomWorldConfig;
if (!isClass _cfgWorld) then
{
_cfgWorld = configFile >> "CfgWorlds" >> worldName;
};
};

_worldName = gettext (_cfgWorld >> "description");
_pictureMap = gettext (_cfgWorld >> "pictureMap");
if (_pictureMap == "") then {_pictureMap = "#(argb,8,8,3)color(1,1,1,0.2)";};
_pictureShot = gettext (_cfgWorld >> "pictureShot");
_loadingTexts = getarray (_cfgWorld >> "loadingTexts");
_loadingText = if (count _loadingTexts > 0) then {
_loadingTexts select floor (((diag_ticktime / 10) % (count _loadingTexts)));
} else {
""
};


_worldType = uinamespace getvariable ["RscDisplayLoading_worldType",""];
_ran = uinamespace getvariable ["RscDisplayLoading_ran",random 1];
if (worldname != _worldType) then {
_ran = random 1;
uinamespace setvariable ["RscDisplayLoading_ran",_ran];
uinamespace setvariable ["RscDisplayLoading_worldType",worldname];
};
_ctrlMapPos = ctrlposition _ctrlMap;
_ctrlMapPos set [1,linearconversion [0,1,_ran,(safezoneY + safezoneH - (_ctrlMapPos select 3)),safezoneY,true]];
_ctrlMap ctrlsetposition _ctrlMapPos;
_ctrlMap ctrlcommit 0;


_ctrlMap ctrlsettext _pictureMap;
_ctrlMapName ctrlsettext toupper _worldName;
_ctrlMapAuthor ctrlsettext _author;
_ctrlMapDescription ctrlsetstructuredtext parsetext _loadingText;

[_cfgWorld,_ctrlMapAuthor] call bis_fnc_overviewauthor;
};


_fnc_loadMission = {

disableserialization;
_display = _this select 0;
_isMultiplayer = servertime > 0;

_ctrlMissionType = _display displayctrl 		1012;
_ctrlMissionName = _display displayctrl 		1006;
_ctrlMissionAuthor = _display displayctrl 		1007;
_ctrlMissionPicture = _display displayctrl 105;
_ctrlMissionProgress = _display displayctrl 103;
_ctrlMissionDescription = _display displayctrl 	1100;
_ctrlMissionDescriptionEngine = _display displayctrl 101;


_loadingPicture = getmissionconfigvalue ["loadScreen",""];
if (_loadingPicture == "") then {_loadingPicture = getmissionconfigvalue ["overviewPicture",""]};


_loadingName = getmissionconfigvalue ["onLoadName",""];
if (_loadingName == "") then {
_loadingName = if (briefingname != missionname) then {briefingname} else {""};
};



_loadingTextConfig = getmissionconfigvalue ["onLoadMission",""];
_loadingText = ctrltext _ctrlMissionDescriptionEngine;
if (_loadingText == "") then {_loadingText = _loadingTextConfig;}; 
if (_loadingText in ["",localize "str_load_world"]) then {_loadingText = getmissionconfigvalue ["overviewText",""];};


_gameType = gettext (getMissionConfig "Header" >> "gameType");
_gameTypeName = gettext (configfile >> "CfgMPGameTypes" >> _gameType >> "name");
if (_gameTypeName == "") then {_gameTypeName = gettext (configfile >> "CfgMPGameTypes" >> "Unknown" >> "name");};






_last = uinamespace getvariable ["RscDisplayLoading_last",[worldname,missionname]];
_lastWorld = _last select 0;
_lastMission = _last select 1;
_showMission = if (missionname == _lastMission) then {worldname == _lastWorld} else {true};
uinamespace setvariable ["RscDisplayLoading_last",[worldname,missionname]];


_progressMap = _display displayctrl 104;
if (isnull _progressMap) then {_display displayctrl 103};
_progressMission = _display displayctrl 		1013;
RscDisplayLoading_progress = _progressMap;


if (_loadingText != "" || {_loadingPicture != ""}) then {
_loadingName = _loadingName call (uinamespace getvariable "bis_fnc_localize");
_loadingText = _loadingText call (uinamespace getvariable "bis_fnc_localize");

if (_loadingName == "") then {_loadingName = localize "STR_a3_rscdisplay_loading_noname";};
if (_loadingPicture == "") then {_loadingPicture = _pictureShot;};

if (_gameTypeName != "" && _isMultiplayer) then {
_ctrlMissionType ctrlsettext toupper _gameTypeName;
} else {
_ctrlMissionType ctrlshow false;
};
_ctrlMissionName ctrlsettext toupper _loadingName;
_ctrlMissionPicture ctrlsettext _loadingPicture;
_ctrlMissionDescription ctrlsetstructuredtext parsetext _loadingText;


_ctrlMissionDescriptionPos = ctrlposition _ctrlMissionDescription;
_ctrlMissionDescriptionPos set [3,ctrltextheight _ctrlMissionDescription + 0.01];
if (_loadingText == "") then {_ctrlMissionDescriptionPos set [3,0];};
_ctrlMissionDescription ctrlsetposition _ctrlMissionDescriptionPos;
_ctrlMissionDescription ctrlcommit 0;

_ctrlMissionPos = ctrlposition _ctrlMission;
_ctrlMissionPos set [3,(_ctrlMissionDescriptionPos select 1) + ((_ctrlMissionDescriptionPos select 3) min ((ctrlposition _ctrlMissionPicture select 3)))];
_ctrlMission ctrlsetposition _ctrlMissionPos;
_ctrlMission ctrlcommit 0;

[missionconfigfile,_ctrlMissionAuthor] call bis_fnc_overviewauthor;






_missionDLCs = [];
{
_appId = getNumber(configfile >> "CfgMods" >> _x >> "appId");
_missionDLCs = _missionDLCs + [_appId];
} foreach (getMissionDlcs); 

_notOwnedDLCs = [];
_showDLCLoading = false;

{
if((isDlcAvailable _x) && (_x in _missionDLCs)) then
{
_notOwnedDLCs = _notOwnedDLCs + [_x];
_showDLCLoading = true;
};
} foreach (getDlcs 2); 

if(_showDLCLoading) then
{
_selectedDLCAppId = uinamespace getvariable ['BIS_RscDisplayLoading_SelectedDLCAppId', 0];

if(_selectedDLCAppId == 0) then
{




_selectedDLC = floor(random (count _notOwnedDLCs));
_selectedDLCAppId = _notOwnedDLCs select _selectedDLC;
uinamespace setvariable ["BIS_RscDisplayLoading_SelectedDLCAppId", _selectedDLCAppId];
};

{ 
if(getNumber(_x >> "appId") == _selectedDLCAppId) then
{
_dlcColor = getArray(_x >> "dlcColor");

if(count _dlcColor != 4) then
{
_dlcColor = [
(profilenamespace getvariable ['GUI_BCG_RGB_R',0.77]),
(profilenamespace getvariable ['GUI_BCG_RGB_G',0.51]),
(profilenamespace getvariable ['GUI_BCG_RGB_B',0.08]),
1];
};


_ctrl = _display displayctrl 			3207;
_ctrl ctrlSetText getText(_x >> "name");
_ctrl ctrlSetTextColor _dlcColor;

_ctrl = _display displayctrl 		3208;
_ctrl ctrlSetText (format [localize "STR_FORMAT_AUTHOR_SCRIPTED", getText(_x >> "author")]);
_ctrl ctrlSetTextColor _dlcColor;

_ctrl = _display displayctrl 		3395;
_ctrl ctrlSetTextColor _dlcColor;

_ctrl = _display displayctrl 			3396;
_ctrl ctrlSetText getText(_x >> "logo");

_ctrl = _display displayctrl 		3209;
_ctrl ctrlSetBackgroundColor _dlcColor;

_ctrl = _display displayctrl 		3393;
_ctrl ctrlSetText getText(_x >> "overviewPicture");

_ctrl = _display displayctrl 		3296;
_ctrl ctrlSetStructuredText (parseText getText(_x >> "overviewText"));
};
} foreach ((configfile >> "CfgMods") call bis_fnc_returnChildren);
};


_ctrlDLCDescription = _display displayctrl 		3296;
_ctrlDLCDescriptionPos = ctrlposition _ctrlDLCDescription;
_ctrlDLCDescriptionPos set [3, (ctrltextheight _ctrlDLCDescription) + 0.01]; 
_ctrlDLCDescription ctrlsetposition _ctrlDLCDescriptionPos;
_ctrlDLCDescription ctrlcommit 0;


{
(_display displayctrl _x) ctrlshow _showDLCLoading;
}
forEach
[
		3209,
		3393,
		3296,
			3207,
		3208,
		3395,
			3396
];





_progressMapPos = ctrlposition _progressMap;
_progressMissionPos = ctrlposition _progressMission;
if (missionnamespace getvariable ["RscDisplayLoading_progressMission",false]) then {


_progressMap ctrlsetposition _progressMissionPos;
_progressMap ctrlcommit 0;
_progressMission ctrlsetposition _progressMapPos;
_progressMission ctrlcommit 0;
_progressMission progresssetposition 1;
} else {


_limit = [1,2] select _isMultiplayer;
if (count (uinamespace getvariable "loading_displays") > _limit) then {
_progressMap ctrlshow false;
_progressMission ctrlsetposition _progressMapPos;
_progressMission ctrlcommit 0;
_progressMission progresssetposition 0.33;
} else {
_progressMission ctrlshow false;
};
};
} else {
_ctrlMission ctrlsetfade 1;
_ctrlMission ctrlcommit 0;
};
};

_ctrlMission = _display displayctrl 			2300;
if (!(isnull _ctrlMission)) then {
[_display,0] call _fnc_loadMission;

};


if (getnumber (configfile >> "CfgMods" >> "gamma") == 1) then
{
_ctrlDisclaimer = _display displayctrl 		2301;
_ctrlDisclaimerName = _display displayctrl 		1009;
_ctrlDisclaimerDescription = _display displayctrl 	1101;
_productVersionArray = productversion;
_versionNr = ctrltext ((finddisplay 0) displayctrl 118);

if (_productVersionArray select 4 == "Development") then
{
_disclaimerName = format ["%1 - %2", localize "STR_A3_RSCDISPLAY_LOADING_DEV", _versionNr];

if(_productVersionArray select 5) then
{

_disclaimerName = _disclaimerName + "<img image='A3\Ui_f\data\GUI\RscCommon\RscTrafficLight\TrafficLight_ca.paa'/>";
};

_ctrlDisclaimerName ctrlSetStructuredText parseText _disclaimerName;
_ctrlDisclaimerDescription ctrlsetstructuredtext parsetext localize "STR_A3_RSCDISPLAY_LOADING_DEVINFO";
_ctrlDisclaimerDescription ctrlsettextcolor [1,1,1,1];
[_ctrlDisclaimerDescription,0.01] call bis_fnc_ctrlFitToTextHeight;
_ctrlDisclaimer ctrlshow true;
}
else
{
if(_productVersionArray select 5) then
{

_ctrlDisclaimerName ctrlSetStructuredText parseText format ["%1 - %2%3", localize "STR_A3_RSCDISPLAY_LOADING_STABLE",
_versionNr,
"<img image='A3\Ui_f\data\GUI\RscCommon\RscTrafficLight\TrafficLight_ca.paa'/>"];

_ctrlDisclaimerDescription ctrlsetstructuredtext parsetext localize "STR_A3_RSCDISPLAY_LOADING_MODDEDINFO";
_ctrlDisclaimerDescription ctrlsettextcolor [1,1,1,1];
[_ctrlDisclaimerDescription,0.01] call bis_fnc_ctrlFitToTextHeight;
_ctrlDisclaimer ctrlshow true;
}
else
{
_ctrlDisclaimer ctrlshow false;
};
};
};







};
};
